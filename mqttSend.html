<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Sender</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
</head>
<body>
    <h1>MQTT Sender</h1>
    <p>Broker: mqtt-dashboard.com:8884</p>
    <p>Topic: hkust/ece/enose/</p>
    <input type="text" id="message" placeholder="Enter message to send">
    <button onclick="sendMessage()">Send</button>
    <div id="status">Connecting...</div>

    <script>
        // Create a client instance
        var client = new Paho.MQTT.Client("broker.hivemq.com", 8884, "sender-client-" + parseInt(Math.random() * 100, 10));

        // Set callback handlers
        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;

        // Connect the client
        client.connect({
            onSuccess: onConnect,
            onFailure: function (responseObject) {
                console.error("Connection failed: " + responseObject.errorMessage);
                document.getElementById("status").innerHTML = "Connection failed: " + responseObject.errorMessage;
            },
            useSSL: true,
            reconnect: true
        });

        // Called when the client connects
        function onConnect() {
            document.getElementById("status").innerHTML = "Connected to broker";
        }

        // Called when the client loses its connection
        function onConnectionLost(responseObject) {
            if (responseObject.errorCode !== 0) {
                document.getElementById("status").innerHTML = "Connection lost: " + responseObject.errorMessage;
            }
        }

        // Called when a message arrives (though not subscribed, included for completeness)
        function onMessageArrived(message) {
            console.log("Message arrived: " + message.payloadString);
        }

        // Function to send message
        function sendMessage() {
            var messageText = document.getElementById("message").value;
            if (messageText && client.isConnected()) {
                var message = new Paho.MQTT.Message(messageText);
                message.destinationName = "hkust/ece/enose/";
                client.send(message);
                document.getElementById("status").innerHTML = "Message sent: " + messageText;
            } 
            else if (!client.isConnected()) {
                document.getElementById("status").innerHTML = "Not connected to broker";
            }
            else {
                document.getElementById("status").innerHTML = "Not connected or empty message";
            }
        }
    </script>
</body>
</html>
